<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
    <title>Content Manager</title>
</head>

<body>
    <!-- Add these scripts to the bottom of the body -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/decap-cms@^3.1.2/dist/decap-cms.js"></script>

    <script>
        window.CMS.registerPreviewStyle("/admin/custom.css");

        const PagesPreview = createClass({
            render: function () {
                const entry = this.props.entry;
                const widgetFor = this.props.widgetFor;
                const widgetsFor = this.props.widgetsFor;
                const getAsset = this.props.getAsset;

                const title = entry && entry.getIn ? entry.getIn([ 'data', 'title' ]) : '';
                const urlSlug = entry && entry.getIn ? entry.getIn([ 'data', 'url-slug' ]) : '';
                const description = entry && entry.getIn ? entry.getIn([ 'data', 'description' ]) : '';
                const featuredImage = entry && entry.getIn ? entry.getIn([ 'data', 'featured_image' ]) : '';
                let blockEls = null;

                const blocks = widgetsFor && typeof widgetsFor === 'function' ? widgetsFor('blocks') : null;

                if (blocks && typeof blocks.map === 'function' && blocks.size > 0) {
                    blockEls = blocks.map(function (block) {
                        const type = block && block.getIn ? block.getIn([ 'data', 'type' ]) : '';

                        if (type === 'hero') {
                            const headline = block.getIn([ 'data', 'headline' ]) || '';
                            const image = block.getIn([ 'data', 'image' ]) || '';
                            return h('section', { className: 'preview-hero' },
                                h('h2', {}, headline),
                                image ? h('img', { src: getAsset ? getAsset(image) : '', style: { maxWidth: '100%' } }) : null
                            );
                        } else if (type === 'paragraph') {
                            const textWidget = block.getIn([ 'widgets', 'text' ]) || '';
                            return h('section', { className: 'preview-paragraph' },
                                textWidget
                            );
                        } else if (type === 'usps_section') {
                            const sectionTitle = block.getIn([ 'data', 'section_title' ]) || '';
                            const usps = block.getIn([ 'data', 'usps' ]);
                            return h('section', { className: 'preview-usps' },
                                h('h3', {}, sectionTitle),
                                usps && typeof usps.map === 'function' ? usps.map(function (usp) {
                                    const uspTitle = usp && usp.get ? usp.get('usp_title') : '';
                                    const uspDesc = usp && usp.get ? usp.get('usp_description') : '';
                                    return h('div', { className: 'preview-usp' },
                                        h('strong', {}, uspTitle),
                                        h('p', {}, uspDesc)
                                    );
                                }) : null
                            );
                        } else if (type === 'slider') {
                            const slides = block.getIn([ 'data', 'slides' ]);
                            return h('section', { className: 'preview-slider' },
                                h('h4', {}, 'Slider'),
                                slides && typeof slides.map === 'function' ? slides.map(function (img) {
                                    const imgSrc = img && img.get ? (getAsset ? getAsset(img.get('image')) : '') : (getAsset ? getAsset(img) : '');
                                    return h('img', { src: imgSrc, style: { maxWidth: '100px', marginRight: '8px' } });
                                }) : null
                            );
                        } else if (type === 'secondary_menu') {
                            const menuName = block.getIn([ 'data', 'menu-name' ]) || '';
                            return h('section', { className: 'preview-secondary-menu' },
                                h('h4', {}, 'Secondary Menu'),
                                h('p', {}, menuName)
                            );
                        } else {
                            return h('div', {}, 'Unknown block type');
                        }
                    });
                }

                return h('div', { className: 'preview-page' },
                    h('h1', { className: 'preview-title' }, title),
                    h('h2', { className: 'preview-url-slug' }, urlSlug),
                    featuredImage ? h('img', { className: 'preview-featured-image', src: getAsset ? getAsset(featuredImage) : '', style: { maxWidth: '100%' } }) : null,
                    description ? h('p', { className: 'preview-description' }, description) : null,
                    blockEls
                );
            }
        });

        window.CMS.registerPreviewTemplate("pages", PagesPreview);
    </script>
</body>

</html>